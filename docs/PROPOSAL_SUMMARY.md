# アーキテクチャ改善提案 - エグゼクティブサマリー

## 現状の課題

### データ分析結果（2025-12-19実績）
- **収集件数**: 1003件
- **Top 2投稿**: 両方とも「RT @OpenAI」で0 Like
- **問題点**:
  - 70%以上がリツイート（編集価値なし）
  - LLMコスト: $7.5/月（1003件評価）
  - 処理時間: 約8分/日
  - VIP向け「重要2件」がRTで価値低い

## 提案する解決策

### 4段階フィルタリングパイプライン

```
1000件（Raw）
  ↓ Phase 1: ノイズ除去（RT除外、外国語除外、スパム除外）
300件（70%削減）
  ↓ Phase 2: 品質フィルタ（軽量スコアリング）
200件（33%削減）
  ↓ Phase 3: LLM Semantic評価
200件（スコア付き）
  ↓ Phase 4: カテゴリ分類 + 最終スコア
Top 2件（VIP向け）+ 200件（一般向け）
```

### 改善効果

| 指標 | 現状 | 改善後 | 削減率 |
|------|------|--------|--------|
| LLMコスト | $7.5/月 | $1.5/月 | 80% |
| 処理時間 | 8分/日 | 2分/日 | 75% |
| Top 2品質 | RT（0 Like） | オリジナル投稿 | - |
| VIP満足度 | 不明 | 目標90%+ | - |

---

## 設計の3本柱

### 1. 段階的フィルタリング（ADR 001）

**目的**: 低品質投稿を早期除去してLLMコスト削減

**実装**:
- **RT Filter**: RTを除外（Quote RTは許可）
- **Language Filter**: 日本語・英語のみ
- **Spam Filter**: URL過多、絵文字過多、宣伝キーワード
- **Relevance Filter**: AI関連キーワード含有

**効果**: 1000件 → 300件（70%削減）

### 2. スコアリング再設計（ADR 002）

**目的**: RTを最高スコアから排除、優先インフルエンサーを上位に

**変更点**:
- **RT除外**: Phase 1で削除（スコアリング不要）
- **正規化改善**: log10 → sqrt（フォロワー数影響を適正化）
- **重み変更**: Quality 40% + Semantic 60%（内容重視）
- **優先ボーナス増**: +15 → +25（インフルエンサー優遇）

**効果**: Top 2がオリジナル投稿、優先インフルエンサーTop 10入り

### 3. カテゴリ分類システム（ADR 003予定）

**目的**: VIP向け選定基準を明確化

**カテゴリ** (8種):
1. RESEARCH（研究）: +15ボーナス
2. PRODUCT（製品）: +12
3. NEWS（ニュース）: +10
4. TOOL（ツール）: +8
5. TUTORIAL（解説）: +5
6. SHOWCASE（作品）: +5
7. OPINION（考察）: +3
8. EVENT（イベント）: +2

**効果**: RESEARCHが最優先、VIPに届けるべき投稿を自動選定

---

## 実装計画（6週間）

### Week 1-2: Phase 1 - フィルタリング基盤
- [ ] RTフィルタ実装
- [ ] 言語・スパム・関連性フィルタ実装
- [ ] パイプライン統合
- [ ] 検証: 1000件 → 300件削減

### Week 3-4: Phase 2 - スコアリング改善
- [ ] Quality Scorer実装（sqrt正規化）
- [ ] Final Scorer実装（重み変更）
- [ ] 検証: Top 2がオリジナル投稿

### Week 5: Phase 3 - カテゴリ分類
- [ ] LLM分類プロンプト作成
- [ ] カテゴリボーナス適用
- [ ] 検証: VIP Top 2がRESEARCH/PRODUCT/NEWS

### Week 6: Phase 4 - 統合・検証
- [ ] daily.ts統合
- [ ] E2Eテスト
- [ ] VIPレビュー

---

## コスト・リスク分析

### コスト削減
- **開発コスト**: $0（既存環境で実装）
- **月額削減**: $6/月（LLM $7.5 → $1.5）
- **年間削減**: $72/年
- **時間削減**: 6分/日 × 365 = 36.5時間/年

### リスクと軽減策

| リスク | 確率 | 影響 | 軽減策 |
|--------|------|------|--------|
| フィルタミスで良質投稿除外 | Medium | High | ホワイトリスト機能（優先アカウント保護） |
| LLM分類精度不足 | Medium | Medium | Few-shot プロンプト + 手動補正（月1） |
| 初期調整に時間 | High | Low | 保守的な初期値 + 2週間運用後調整 |
| X API制限超過 | Low | High | レート制限管理（Redis） |

---

## 成功基準

### 技術指標
- [ ] RT除外率 >95%
- [ ] 処理時間 <2分/日
- [ ] LLMコスト <$2/月
- [ ] テストカバレッジ >80%

### ビジネス指標
- [ ] VIP Top 2がオリジナル投稿（RT 0件）
- [ ] 優先インフルエンサーTop 10に3名以上
- [ ] VIP満足度 >90%（アンケート）
- [ ] note記事生成時間50%短縮

---

## 承認項目

### ステークホルダー承認チェックリスト

#### 技術承認
- [ ] アーキテクチャ設計（ARCHITECTURE.md）レビュー完了
- [ ] ADR（設計判断記録）承認
- [ ] 実装ガイド（IMPLEMENTATION_GUIDE.md）確認

#### ビジネス承認
- [ ] コスト削減効果（$72/年）承認
- [ ] 6週間タイムライン承認
- [ ] VIP向け改善内容（カテゴリ分類）承認

#### リスク承認
- [ ] フィルタミスリスク理解
- [ ] 過去スコア互換性なし了承
- [ ] 初期調整期間（2週間）了承

---

## Next Actions

### 即座実行（今日）
1. **本提案レビュー**: ARCHITECTURE.md, ADR 001-002, IMPLEMENTATION_GUIDE.md
2. **承認判断**: Go/No-Go決定
3. **PoC準備**: RTフィルタのみ実装（3日以内）

### Week 1開始時
1. **開発着手**: Phase 1実装開始
2. **日次確認**: 進捗チェック（毎日15分）
3. **週次レビュー**: 金曜日に完了タスク確認

---

## 参考ドキュメント

### 作成済みドキュメント
- **/Users/yuco/div/taissunyuco/docs/ARCHITECTURE.md**: 詳細設計書（C4図、技術スタック、品質指標）
- **/Users/yuco/div/taissunyuco/docs/adr/001-filtering-pipeline.md**: フィルタリング設計判断
- **/Users/yuco/div/taissunyuco/docs/adr/002-scoring-redesign.md**: スコアリング再設計判断
- **/Users/yuco/div/taissunyuco/docs/IMPLEMENTATION_GUIDE.md**: 実装手順書（コード例、テスト方法）

### 既存ドキュメント
- /Users/yuco/div/taissunyuco/docs/requirements.md: 要件定義書
- /Users/yuco/div/taissunyuco/config/config.json: システム設定

### 実データ
- /Users/yuco/div/taissunyuco/data/collected_2025-12-19.json: 収集データ（1003件）
- /Users/yuco/div/taissunyuco/data/scored_2025-12-19.json: スコアデータ（問題事例）

---

## 質問・フィードバック

### よくある質問

**Q1: なぜRTを完全除外するのか？**
A: RTは情報の再配信で編集価値なし。VIPが求めるのはオリジナルの洞察・発見。Quote RT（コメント付き）は許可。

**Q2: 過去スコアと比較できなくなる問題は？**
A: 新スコア体系で過去データを再評価すれば可能（オプション実装）。優先度低。

**Q3: フィルタで重要投稿を除外しないか？**
A: ホワイトリスト機能で優先アカウント7名は保護。除外ログを週1確認して調整。

**Q4: LLM分類精度が低かったら？**
A: Few-shot プロンプト改善 + 手動補正（月1回、30分）で対応。

**Q5: 6週間は長すぎないか？**
A: Phase 1-2（4週間）でコア改善完了。Phase 3-4は付加価値機能。

### フィードバック募集項目
- カテゴリ定義（8種類）は適切か
- 優先ボーナス+25は十分か
- 実装優先度（Phase 1-4の順序）

---

## 結論

本提案により、以下を実現：

1. **品質向上**: RT除去でVIP向け「重要2件」が真の価値投稿に
2. **コスト削減**: LLM評価80%削減（$7.5 → $1.5/月）
3. **時間短縮**: 75%削減（8分 → 2分/日）
4. **選定明確化**: カテゴリ分類でRESEARCH優先の自動選定

**推奨判断**: 承認 → Phase 1即座着手

**初期投資**: $0（既存環境で実装可能）
**月額コスト**: $1.5（LLM API）
**ROI**: 年間$72削減 + 36.5時間削減 + VIP満足度向上

---

## 承認サイン

- [ ] 技術責任者（自分）: ______________________  日付: _______
- [ ] VIP代表（任意）: ______________________  日付: _______

承認後、Phase 1（RTフィルタPoC）を3日以内に着手します。
